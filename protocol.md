# 简单文件上传下载协议

该协议基于 TCP 协议，客户端向服务端发送1一到多个请求，服务器进行响应。

## 数据格式

客户端到服务端的请求格式：

首先是一个字节，表示请求的类型，0x00 表示下载，0x01 表示上传，其他值都非法。

接着 256 字节是文件名，如果文件名长度不足 256 需要用 0x00 填充，如果文件名长度恰好为 256 则不需要额外的 0x00，不支持长于 256 字节的文件名。

如果是下载请求，那么请求就结束了。

如果是上传请求，那么接下来四个字节，以大端序保存了文件内容的长度，不支持大小达到 4GiB 的文件。接着就是文件内容。

总的来说，下载文件的请求格式：

| 0x00 | NAME |

上传文件的请求格式：

| 0x01 | NAME | BODY_LEN | BODY |

服务端到客户端的响应格式：

首先一个字节，表示响应的类型。0x00 表示操作失败，0x01 表示上传成功，0x02 表示下载成功，其他取值都非法。

如果是上传成功（0x01）和操作失败（0x00）的响应，请求就结束了。

如果是下载成功的响应，接下来四个字节，以大端序保存了文件内容的长度，不支持大小达到 4GiB 的文件，接着就是文件内容。

总的来说，上传成功的响应格式：

| 0x01 |

操作失败的响应格式：

| 0x00 |

下载成功的响应格式：

| 0x02 | BODY_LEN | BODY |

## 协议流程

协议的流程如下：

1. 客户端向服务端发起链接
2. 客户端向服务端发送若干个请求
3. 同时服务端向客户端按顺序返回若干个请求的回应

服务端应当：

1. 保证回应和请求的顺序是一致的
2. 当客户端发送非法格式的请求的时候关闭连接
3. 在遇到找不到文件、无法打开文件、文件大小达到 4GiB 的时候向客户端返回操作失败的错误

客户端应当：

1. 按顺序发送一到多个请求
2. 遇到文件名长度大于 256 时报错
3. 遇到文件大小大于或等于 2^32 字节时报错